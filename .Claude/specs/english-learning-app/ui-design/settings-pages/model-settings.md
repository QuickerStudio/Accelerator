# æ¨¡å‹è®¾ç½®é¡µé¢ (Model Settings)

## è®¾è®¡æ€è·¯

ç”¨æˆ·å¯ä»¥é…ç½® AI æ¨¡å‹çš„å‚æ•°å’Œç³»ç»Ÿæç¤ºè¯ã€‚é¡µé¢é‡‡ç”¨å¡ç‰‡å¼å¸ƒå±€ï¼ŒåŒ…å«å½“å‰æ¨¡å‹ä¿¡æ¯ã€ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘ï¼ˆ5ä¸ªè§’è‰²é€‰é¡¹å¡ï¼‰ã€æ¨¡å‹å‚æ•°è°ƒèŠ‚ç­‰åŠŸèƒ½ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- Agent è§’è‰²æ ¹æ®åº•éƒ¨å¯¼èˆªæ è‡ªåŠ¨åˆ‡æ¢ï¼ˆå•è¯é¡µâ†’å•è¯å­¦ä¹ ï¼Œå£è¯­é¡µâ†’å£è¯­é™ªç»ƒç­‰ï¼‰
- ç”¨æˆ·å¯ä»¥åœ¨æ­¤é¡µé¢æŸ¥çœ‹å’Œç¼–è¾‘æ¯ä¸ª Agent è§’è‰²çš„ç³»ç»Ÿæç¤ºè¯
- é€šè¿‡é€‰é¡¹å¡åˆ‡æ¢ä¸åŒè§’è‰²çš„æç¤ºè¯è¿›è¡Œç¼–è¾‘
- æ”¯æŒä¿å­˜è‡ªå®šä¹‰æç¤ºè¯å’Œé‡ç½®ä¸ºé¢„è®¾
- æ¨¡å‹å‚æ•°å¯ç‹¬ç«‹è°ƒæ•´ï¼ˆæ¸©åº¦ã€æœ€å¤§é•¿åº¦ã€Top Pï¼‰

---

## å¸ƒå±€ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¶éƒ¨å¯¼èˆªæ                        â”‚
â”‚  â†  æ¨¡å‹è®¾ç½®                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  å½“å‰æ¨¡å‹                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¤– Qwen2.5-3B           â”‚   â”‚
â”‚  â”‚ æœ¬åœ°æ¨¡å‹ï¼Œå®Œå…¨ç¦»çº¿        â”‚   â”‚
â”‚  â”‚         [âœ“]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  ç³»ç»Ÿæç¤ºè¯                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“šå•è¯ ğŸ”è¯­æ³• âœï¸ä½œæ–‡     â”‚   â”‚
â”‚  â”‚ ï¿½å£è¯­ ğŸ“Šè§„åˆ’            â”‚   â”‚
â”‚  â”‚ (æ¨ªå‘æ»šåŠ¨é€‰é¡¹å¡)         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚ ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‹±è¯­å•è¯... â”‚   â”‚
â”‚  â”‚ (å¯ç¼–è¾‘æ–‡æœ¬åŒºåŸŸ)         â”‚   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚ [ä¿å­˜] [é‡ç½®ä¸ºé¢„è®¾]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  æ¨¡å‹å‚æ•°                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ¸©åº¦ (Temperature)       â”‚   â”‚
â”‚  â”‚ åˆ›é€ æ€§ â”â”â”â—â”â”â”â”â”â” ç²¾ç¡®æ€§ â”‚   â”‚
â”‚  â”‚        0.7              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æœ€å¤§é•¿åº¦ (Max Tokens)    â”‚   â”‚
â”‚  â”‚ çŸ­ â”â”â”â”â”â”â”â—â”â”â”â”â”â”â” é•¿   â”‚   â”‚
â”‚  â”‚        512              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Top P                   â”‚   â”‚
â”‚  â”‚ ä¿å®ˆ â”â”â”â”â”â—â”â”â”â”â”â” å¤šæ ·  â”‚   â”‚
â”‚  â”‚        0.9              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  [æ¢å¤é»˜è®¤è®¾ç½®]                  â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è®¾è®¡ç»†èŠ‚

### é¡¶éƒ¨å¯¼èˆªæ 
- é«˜åº¦: 64.dp
- èƒŒæ™¯: æ·±è‰² (#1E1E1E)
- å†…è¾¹è·: æ°´å¹³16.dp
- å¸ƒå±€: æ°´å¹³æ’åˆ—
- ç»„ä»¶:
  - **è¿”å›æŒ‰é’®** (â†): 48.dp Ã— 48.dp, å›¾æ ‡24.dpç™½è‰²
  - **æ ‡é¢˜**: "æ¨¡å‹è®¾ç½®", HeadlineMedium (20.sp), ç™½è‰²

### å½“å‰æ¨¡å‹å¡ç‰‡
- å®½åº¦: match_parent - 32.dp
- é«˜åº¦: wrap_content
- åœ†è§’: CornerRadius.large (16.dp)
- èƒŒæ™¯: ä¸»é¢˜è‰²æ¸å˜ (#6366F1 â†’ #8B5CF6)
- å†…è¾¹è·: 20.dp
- è¾¹è·: æ°´å¹³16.dp, é¡¶éƒ¨16.dp
- é˜´å½±: elevation = 4.dp

- ç»„ä»¶:
  - **æ¨¡å‹å›¾æ ‡**: ğŸ¤–, 32.dp, ç™½è‰²
  - **æ¨¡å‹åç§°**: "Qwen2.5-3B", HeadlineMedium (18.sp), ç™½è‰², ç²—ä½“
  - **æ¨¡å‹æè¿°**: "æœ¬åœ°æ¨¡å‹ï¼Œå®Œå…¨ç¦»çº¿", BodyMedium (14.sp), ç™½è‰²é€æ˜80%
  - **é€‰ä¸­æ ‡è®°**: âœ“, 24.dp, ç™½è‰², å³ä¸Šè§’

### ç³»ç»Ÿæç¤ºè¯åŒºåŸŸ
- æ ‡é¢˜: "ç³»ç»Ÿæç¤ºè¯", HeadlineSmall (16.sp), ç™½è‰², ç²—ä½“
- å†…è¾¹è·: æ°´å¹³16.dp, é¡¶éƒ¨24.dp, åº•éƒ¨12.dp
- è¯´æ˜: "ä¸ºä¸åŒåœºæ™¯å®šåˆ¶ AI çš„è¡Œä¸ºå’Œé£æ ¼", BodySmall (12.sp), ç°è‰²

### è§’è‰²é€‰é¡¹å¡
- å¸ƒå±€: æ°´å¹³æ»šåŠ¨è¡Œï¼ˆScrollableTabRowï¼‰
- é«˜åº¦: 48.dp
- èƒŒæ™¯: æ·±è‰²å¡ç‰‡ (#2A2A2A)
- åœ†è§’: é¡¶éƒ¨ CornerRadius.large (16.dp)
- è¾¹è·: æ°´å¹³16.dp, é¡¶éƒ¨12.dp

**é€‰é¡¹å¡æŒ‰é’®**:
- å®½åº¦: wrap_content, æœ€å°å®½åº¦ 80.dp
- é«˜åº¦: 48.dp
- å†…è¾¹è·: æ°´å¹³16.dp
- æœªé€‰ä¸­: èƒŒæ™¯é€æ˜ï¼Œæ–‡æœ¬ç°è‰²
- é€‰ä¸­: èƒŒæ™¯ä¸»é¢˜è‰²ï¼Œæ–‡æœ¬ç™½è‰²ï¼Œåœ†è§’12.dp
- åŠ¨ç”»: 300ms å¹³æ»‘è¿‡æ¸¡

**5 ä¸ªé€‰é¡¹å¡**:
1. **ğŸ“š å•è¯å­¦ä¹ ** (VocabularyTutor)
   - é»˜è®¤æ¸©åº¦: 0.7, Max Tokens: 512
   
2. **ğŸ” è¯­æ³•æ£€æŸ¥** (GrammarChecker)
   - é»˜è®¤æ¸©åº¦: 0.3, Max Tokens: 1024
   
3. **âœï¸ ä½œæ–‡æ‰¹æ”¹** (EssayReviewer)
   - é»˜è®¤æ¸©åº¦: 0.5, Max Tokens: 2048
   
4. **ğŸ’¬ å£è¯­é™ªç»ƒ** (SpeakingPartner)
   - é»˜è®¤æ¸©åº¦: 0.8, Max Tokens: 512
   
5. **ğŸ“Š å­¦ä¹ è§„åˆ’** (LearningPlanner)
   - é»˜è®¤æ¸©åº¦: 0.5, Max Tokens: 1024

**æ³¨æ„**: Agent è§’è‰²ä¼šæ ¹æ®ç”¨æˆ·æ‰€åœ¨é¡µé¢è‡ªåŠ¨åˆ‡æ¢ï¼ˆå•è¯é¡µâ†’å•è¯å­¦ä¹ ï¼Œå£è¯­é¡µâ†’å£è¯­é™ªç»ƒç­‰ï¼‰ï¼Œæ­¤å¤„ä»…ç”¨äºæŸ¥çœ‹å’Œç¼–è¾‘å„è§’è‰²çš„ç³»ç»Ÿæç¤ºè¯ã€‚

### æç¤ºè¯ç¼–è¾‘æ¡†
- å®½åº¦: match_parent - 32.dp
- æœ€å°é«˜åº¦: 200.dp
- æœ€å¤§é«˜åº¦: 400.dp
- åœ†è§’: åº•éƒ¨ CornerRadius.large (16.dp)
- èƒŒæ™¯: æ·±è‰²å¡ç‰‡ (#2A2A2A)
- å†…è¾¹è·: 16.dp
- è¾¹è·: æ°´å¹³16.dp
- å­—ä½“: BodyMedium (14.sp), ç™½è‰²
- è¡Œé«˜: 22.sp
- å¯æ»šåŠ¨: å‚ç›´æ»šåŠ¨
- å¯ç¼–è¾‘: æ˜¯
- å®æ—¶æ˜¾ç¤ºå­—ç¬¦æ•°
- æœ€å¤§é•¿åº¦: 2000 å­—ç¬¦
- å ä½ç¬¦: "åœ¨æ­¤è¾“å…¥ç³»ç»Ÿæç¤ºè¯..."

**æ˜¾ç¤ºå†…å®¹**:
- æ ¹æ®é€‰ä¸­çš„é€‰é¡¹å¡æ˜¾ç¤ºå¯¹åº”è§’è‰²çš„æç¤ºè¯
- å¦‚æœç”¨æˆ·ä¿®æ”¹è¿‡ï¼Œæ˜¾ç¤ºè‡ªå®šä¹‰å†…å®¹
- å¦‚æœæœªä¿®æ”¹ï¼Œæ˜¾ç¤ºé¢„è®¾å†…å®¹ï¼ˆå¯ç¼–è¾‘ï¼‰

### æç¤ºè¯æ“ä½œæŒ‰é’®
- å¸ƒå±€: æ°´å¹³æ’åˆ—ï¼Œä¸¤ä¸ªæŒ‰é’®
- è¾¹è·: æ°´å¹³16.dp, é¡¶éƒ¨12.dp

**ä¿å­˜æŒ‰é’®**:
- å®½åº¦: å 50% - 6.dp
- é«˜åº¦: 48.dp
- åœ†è§’: CornerRadius.medium (12.dp)
- èƒŒæ™¯: ä¸»é¢˜è‰²
- æ–‡æœ¬: "ä¿å­˜", LabelLarge, ç™½è‰²
- åŠŸèƒ½: ä¿å­˜å½“å‰é€‰é¡¹å¡å¯¹åº”è§’è‰²çš„æç¤ºè¯

**é‡ç½®ä¸ºé¢„è®¾æŒ‰é’®**:
- å®½åº¦: å 50% - 6.dp
- é«˜åº¦: 48.dp
- åœ†è§’: CornerRadius.medium (12.dp)
- èƒŒæ™¯: é€æ˜ï¼Œè¾¹æ¡†1.dpç°è‰²
- æ–‡æœ¬: "é‡ç½®ä¸ºé¢„è®¾", LabelLarge, ç°è‰²
- åŠŸèƒ½: å°†å½“å‰é€‰é¡¹å¡å¯¹åº”è§’è‰²çš„æç¤ºè¯æ¢å¤ä¸ºç³»ç»Ÿé¢„è®¾

### æ¨¡å‹å‚æ•°åŒºåŸŸ
- æ ‡é¢˜: "æ¨¡å‹å‚æ•°", HeadlineSmall (16.sp), ç™½è‰², ç²—ä½“
- å†…è¾¹è·: æ°´å¹³16.dp, é¡¶éƒ¨24.dp, åº•éƒ¨12.dp

### å‚æ•°è°ƒèŠ‚å¡ç‰‡
- å®½åº¦: match_parent - 32.dp
- é«˜åº¦: wrap_content
- åœ†è§’: CornerRadius.large (16.dp)
- èƒŒæ™¯: æ·±è‰²å¡ç‰‡ (#2A2A2A)
- å†…è¾¹è·: 20.dp
- è¾¹è·: æ°´å¹³16.dp, åº•éƒ¨12.dp
- ç»„ä»¶:
  - **å‚æ•°åç§°**: BodyLarge (16.sp), ç™½è‰², ç²—ä½“
  - **å‚æ•°è¯´æ˜**: BodySmall (12.sp), ç°è‰², åº•éƒ¨é—´è·8.dp
  - **æ»‘å—**: é¢œè‰²ä¸»é¢˜è‰², æ ‡ç­¾å·¦å³ä¸¤ä¾§, å½“å‰å€¼å±…ä¸­HeadlineMedium

### å‚æ•°è¯´æ˜

**æ¸©åº¦ (Temperature)**:
- èŒƒå›´: 0.0 - 2.0
- é»˜è®¤å€¼: æ ¹æ® Agent è§’è‰²è‡ªåŠ¨è°ƒæ•´
- è¯´æ˜: æ§åˆ¶è¾“å‡ºçš„éšæœºæ€§
  - 0.0-0.5: ç²¾ç¡®ã€ä¸€è‡´ï¼ˆé€‚åˆè¯­æ³•æ£€æŸ¥ï¼‰
  - 0.5-1.0: å¹³è¡¡ï¼ˆé€‚åˆä½œæ–‡æ‰¹æ”¹ï¼‰
  - 1.0-2.0: åˆ›é€ æ€§ã€å¤šæ ·ï¼ˆé€‚åˆå¯¹è¯ï¼‰

**æœ€å¤§é•¿åº¦ (Max Tokens)**:
- èŒƒå›´: 256 - 4096
- é»˜è®¤å€¼: æ ¹æ® Agent è§’è‰²è‡ªåŠ¨è°ƒæ•´
- è¯´æ˜: æ§åˆ¶ç”Ÿæˆæ–‡æœ¬çš„æœ€å¤§é•¿åº¦
  - 256-512: çŸ­å›å¤ï¼ˆå•è¯è§£é‡Šã€å¯¹è¯ï¼‰
  - 512-1024: ä¸­ç­‰é•¿åº¦ï¼ˆè¯­æ³•æ£€æŸ¥ï¼‰
  - 1024-2048: é•¿æ–‡æœ¬ï¼ˆä½œæ–‡æ‰¹æ”¹ã€å­¦ä¹ è§„åˆ’ï¼‰

**Top P (æ ¸é‡‡æ ·)**:
- èŒƒå›´: 0.0 - 1.0
- é»˜è®¤å€¼: 0.9
- è¯´æ˜: æ§åˆ¶è¾“å‡ºçš„å¤šæ ·æ€§
  - 0.5-0.7: ä¿å®ˆã€ç¨³å®š
  - 0.8-0.9: å¹³è¡¡ï¼ˆæ¨èï¼‰
  - 0.9-1.0: å¤šæ ·ã€åˆ›æ–°

### æ¢å¤é»˜è®¤æŒ‰é’®
- å®½åº¦: match_parent - 32.dp
- é«˜åº¦: 48.dp
- åœ†è§’: CornerRadius.medium (12.dp)
- èƒŒæ™¯: é€æ˜ï¼Œè¾¹æ¡†1.dpä¸»é¢˜è‰²
- æ–‡æœ¬: "æ¢å¤é»˜è®¤è®¾ç½®", LabelLarge, ä¸»é¢˜è‰²
- è¾¹è·: æ°´å¹³16.dp, é¡¶éƒ¨24.dp, åº•éƒ¨16.dp
- åŠŸèƒ½: æ¢å¤å½“å‰ Agent è§’è‰²çš„é»˜è®¤å‚æ•°

---

## çŠ¶æ€ç®¡ç†

```kotlin
data class ModelSettingsUiState(
    val selectedTabIndex: Int = 0,  // å½“å‰é€‰ä¸­çš„é€‰é¡¹å¡ç´¢å¼•
    val agentPrompts: Map<AgentRole, String> = emptyMap(),  // æ¯ä¸ªè§’è‰²çš„æç¤ºè¯
    val currentPrompt: String = "",  // å½“å‰æ˜¾ç¤ºçš„æç¤ºè¯
    val temperature: Float = 0.7f,
    val maxTokens: Int = 512,
    val topP: Float = 0.9f,
    val isLoading: Boolean = false,
    val hasUnsavedChanges: Boolean = false
)

enum class AgentRole(
    val displayName: String,
    val icon: String,
    val defaultPrompt: String,
    val defaultTemperature: Float,
    val defaultMaxTokens: Int
) {
    VOCABULARY_TUTOR(
        displayName = "ğŸ“š å•è¯å­¦ä¹ ",
        icon = "ğŸ“š",
        defaultPrompt = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‹±è¯­å•è¯å­¦ä¹ åŠ©æ‰‹ã€‚
ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. ç”¨ç®€æ´æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå•è¯
2. æä¾›å®ç”¨çš„ä¾‹å¥å’Œè®°å¿†æŠ€å·§
3. å¸®åŠ©å­¦ç”Ÿå¿«é€ŸæŒæ¡å•è¯ç”¨æ³•
4. ä¿æŒå‹å¥½ã€é¼“åŠ±çš„è¯­æ°”""",
        defaultTemperature = 0.7f,
        defaultMaxTokens = 512
    ),
    
    GRAMMAR_CHECKER(
        displayName = "ğŸ” è¯­æ³•æ£€æŸ¥",
        icon = "ğŸ”",
        defaultPrompt = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‹±è¯­è¯­æ³•æ£€æŸ¥å·¥å…·ã€‚
ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. å‡†ç¡®è¯†åˆ«è¯­æ³•é”™è¯¯
2. ç»™å‡ºæ¸…æ™°çš„ä¿®æ”¹å»ºè®®
3. è§£é‡Šé”™è¯¯åŸå› 
4. ä¿æŒå®¢è§‚ã€ä¸“ä¸šçš„è¯­æ°”""",
        defaultTemperature = 0.3f,
        defaultMaxTokens = 1024
    ),
    
    ESSAY_REVIEWER(
        displayName = "âœï¸ ä½œæ–‡æ‰¹æ”¹",
        icon = "âœï¸",
        defaultPrompt = """ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„è‹±è¯­å†™ä½œè€å¸ˆã€‚
ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. å…¨é¢è¯„ä»·å­¦ç”Ÿçš„ä½œæ–‡
2. æŒ‡å‡ºä¼˜ç‚¹å’Œéœ€è¦æ”¹è¿›çš„åœ°æ–¹
3. ç»™å‡ºå…·ä½“çš„æ”¹è¿›å»ºè®®
4. ä¿æŒé¼“åŠ±ã€å»ºè®¾æ€§çš„è¯­æ°”""",
        defaultTemperature = 0.5f,
        defaultMaxTokens = 2048
    ),
    
    SPEAKING_PARTNER(
        displayName = "ğŸ’¬ å£è¯­é™ªç»ƒ",
        icon = "ğŸ’¬",
        defaultPrompt = """ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„è‹±è¯­å£è¯­é™ªç»ƒã€‚
ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. ç”¨è‡ªç„¶çš„è‹±è¯­è¿›è¡Œå¯¹è¯
2. å§”å©‰åœ°çº æ­£è¯­æ³•é”™è¯¯
3. ç»™å‡ºå‘éŸ³å»ºè®®
4. ä¿æŒå¯¹è¯è½»æ¾ã€æœ‰è¶£""",
        defaultTemperature = 0.8f,
        defaultMaxTokens = 512
    ),
    
    LEARNING_PLANNER(
        displayName = "ğŸ“Š å­¦ä¹ è§„åˆ’",
        icon = "ğŸ“Š",
        defaultPrompt = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‹±è¯­å­¦ä¹ è§„åˆ’å¸ˆã€‚
ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. åˆ†æå­¦ç”Ÿçš„å­¦ä¹ çŠ¶æ€
2. åˆ¶å®šä¸ªæ€§åŒ–çš„å­¦ä¹ è®¡åˆ’
3. ç»™å‡ºå®ç”¨çš„å­¦ä¹ å»ºè®®
4. ä¿æŒä¸“ä¸šã€æ¿€åŠ±çš„è¯­æ°”""",
        defaultTemperature = 0.5f,
        defaultMaxTokens = 1024
    )
}

sealed class ModelSettingsEvent {
    data class SelectTab(val index: Int) : ModelSettingsEvent()
    data class UpdatePrompt(val prompt: String) : ModelSettingsEvent()
    object SavePrompt : ModelSettingsEvent()
    object ResetToPreset : ModelSettingsEvent()
    data class UpdateTemperature(val value: Float) : ModelSettingsEvent()
    data class UpdateMaxTokens(val value: Int) : ModelSettingsEvent()
    data class UpdateTopP(val value: Float) : ModelSettingsEvent()
    object RestoreDefaults : ModelSettingsEvent()
}
```

---

## åç«¯ä»£ç 

### AgentService æ¥å£

```kotlin
/**
 * Agent æœåŠ¡æ¥å£
 * ç®¡ç†ä¸åŒçš„ Agent è§’è‰²å’Œç³»ç»Ÿæç¤ºè¯
 */
interface AgentService {
    /**
     * è·å–å½“å‰ Agent è§’è‰²
     */
    fun getCurrentAgent(): AgentRole
    
    /**
     * åˆ‡æ¢ Agent è§’è‰²
     */
    suspend fun switchAgent(agent: AgentRole): Result<Unit>
    
    /**
     * è·å–å½“å‰ç³»ç»Ÿæç¤ºè¯
     */
    fun getCurrentPrompt(): String
    
    /**
     * æ›´æ–°è‡ªå®šä¹‰æç¤ºè¯
     */
    suspend fun updateCustomPrompt(prompt: String): Result<Unit>
    
    /**
     * é‡ç½®ä¸ºé¢„è®¾æç¤ºè¯
     */
    suspend fun resetToPreset(): Result<Unit>
    
    /**
     * ä½¿ç”¨å½“å‰ Agent ç”Ÿæˆå›å¤
     */
    suspend fun generate(
        userInput: String,
        context: List<Message> = emptyList()
    ): Result<String>
}
```

### AgentService å®ç°

```kotlin
class AgentServiceImpl @Inject constructor(
    private val llmService: LLMService,
    private val userSettingsRepository: UserSettingsRepository
) : AgentService {
    
    private var currentAgent: AgentRole = AgentRole.VOCABULARY_TUTOR
    private var promptMode: PromptMode = PromptMode.PRESET
    private var customPrompt: String = ""
    
    init {
        // ä»è®¾ç½®ä¸­åŠ è½½
        viewModelScope.launch {
            val settings = userSettingsRepository.getUserSettings().getOrNull()
            settings?.let {
                currentAgent = it.selectedAgent
                promptMode = it.promptMode
                customPrompt = it.customPrompt
            }
        }
    }
    
    override fun getCurrentAgent(): AgentRole = currentAgent
    
    override suspend fun switchAgent(agent: AgentRole): Result<Unit> {
        return try {
            currentAgent = agent
            // ä¿å­˜åˆ°è®¾ç½®
            userSettingsRepository.updateAgentSettings(
                agent = agent,
                mode = promptMode,
                customPrompt = customPrompt
            )
            Result.Success(Unit)
        } catch (e: Exception) {
            Result.Error(e)
        }
    }
    
    override fun getCurrentPrompt(): String {
        return when (promptMode) {
            PromptMode.PRESET -> currentAgent.defaultPrompt
            PromptMode.CUSTOM -> customPrompt.ifEmpty { currentAgent.defaultPrompt }
        }
    }
    
    override suspend fun updateCustomPrompt(prompt: String): Result<Unit> {
        return try {
            customPrompt = prompt
            promptMode = PromptMode.CUSTOM
            userSettingsRepository.updateAgentSettings(
                agent = currentAgent,
                mode = PromptMode.CUSTOM,
                customPrompt = prompt
            )
            Result.Success(Unit)
        } catch (e: Exception) {
            Result.Error(e)
        }
    }
    
    override suspend fun resetToPreset(): Result<Unit> {
        return try {
            promptMode = PromptMode.PRESET
            customPrompt = ""
            userSettingsRepository.updateAgentSettings(
                agent = currentAgent,
                mode = PromptMode.PRESET,
                customPrompt = ""
            )
            Result.Success(Unit)
        } catch (e: Exception) {
            Result.Error(e)
        }
    }
    
    override suspend fun generate(
        userInput: String,
        context: List<Message>
    ): Result<String> {
        val systemPrompt = getCurrentPrompt()
        val messages = buildList {
            add(Message(role = "system", content = systemPrompt))
            addAll(context)
            add(Message(role = "user", content = userInput))
        }
        
        return llmService.generate(
            prompt = buildPromptString(messages),
            maxTokens = currentAgent.defaultMaxTokens,
            temperature = currentAgent.defaultTemperature
        )
    }
    
    private fun buildPromptString(messages: List<Message>): String {
        return messages.joinToString("\n") { message ->
            "<|im_start|>${message.role}\n${message.content}\n<|im_end|>"
        } + "\n<|im_start|>assistant\n"
    }
}
```

### ViewModel

```kotlin
class ModelSettingsViewModel @Inject constructor(
    private val agentService: AgentService,
    private val userSettingsRepository: UserSettingsRepository
) : ViewModel() {
    
    private val _uiState = MutableStateFlow(ModelSettingsUiState())
    val uiState: StateFlow<ModelSettingsUiState> = _uiState.asStateFlow()
    
    private val agentRoles = AgentRole.values()
    
    init {
        loadSettings()
    }
    
    private fun loadSettings() {
        viewModelScope.launch {
            val settings = userSettingsRepository.getUserSettings().getOrNull()
            settings?.let {
                // åŠ è½½æ‰€æœ‰è§’è‰²çš„æç¤ºè¯
                val prompts = agentRoles.associate { role ->
                    role to (it.agentPrompts[role] ?: role.defaultPrompt)
                }
                
                _uiState.update { state ->
                    state.copy(
                        agentPrompts = prompts,
                        currentPrompt = prompts[agentRoles[0]] ?: "",
                        temperature = it.modelTemperature,
                        maxTokens = it.modelMaxTokens,
                        topP = it.modelTopP
                    )
                }
            }
        }
    }
    
    fun onEvent(event: ModelSettingsEvent) {
        when (event) {
            is ModelSettingsEvent.SelectTab -> selectTab(event.index)
            is ModelSettingsEvent.UpdatePrompt -> updatePrompt(event.prompt)
            is ModelSettingsEvent.SavePrompt -> savePrompt()
            is ModelSettingsEvent.ResetToPreset -> resetToPreset()
            is ModelSettingsEvent.UpdateTemperature -> updateTemperature(event.value)
            is ModelSettingsEvent.UpdateMaxTokens -> updateMaxTokens(event.value)
            is ModelSettingsEvent.UpdateTopP -> updateTopP(event.value)
            is ModelSettingsEvent.RestoreDefaults -> restoreDefaults()
        }
    }
    
    private fun selectTab(index: Int) {
        if (index !in agentRoles.indices) return
        
        val role = agentRoles[index]
        val prompt = _uiState.value.agentPrompts[role] ?: role.defaultPrompt
        
        _uiState.update { state ->
            state.copy(
                selectedTabIndex = index,
                currentPrompt = prompt,
                temperature = role.defaultTemperature,
                maxTokens = role.defaultMaxTokens,
                hasUnsavedChanges = false
            )
        }
    }
    
    private fun updatePrompt(prompt: String) {
        _uiState.update { state ->
            state.copy(
                currentPrompt = prompt,
                hasUnsavedChanges = true
            )
        }
    }
    
    private fun savePrompt() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            val currentRole = agentRoles[_uiState.value.selectedTabIndex]
            val updatedPrompts = _uiState.value.agentPrompts.toMutableMap()
            updatedPrompts[currentRole] = _uiState.value.currentPrompt
            
            // ä¿å­˜åˆ°è®¾ç½®
            userSettingsRepository.updateAgentPrompts(updatedPrompts)
            
            // å¦‚æœå½“å‰é¡µé¢ä½¿ç”¨çš„æ˜¯è¿™ä¸ªè§’è‰²ï¼Œæ›´æ–° AgentService
            if (agentService.getCurrentAgent() == currentRole) {
                agentService.updateCustomPrompt(_uiState.value.currentPrompt)
            }
            
            _uiState.update { state ->
                state.copy(
                    agentPrompts = updatedPrompts,
                    isLoading = false,
                    hasUnsavedChanges = false
                )
            }
        }
    }
    
    private fun resetToPreset() {
        val currentRole = agentRoles[_uiState.value.selectedTabIndex]
        val presetPrompt = currentRole.defaultPrompt
        
        _uiState.update { state ->
            state.copy(
                currentPrompt = presetPrompt,
                hasUnsavedChanges = true
            )
        }
    }
    
    private fun updateTemperature(value: Float) {
        _uiState.update { it.copy(temperature = value) }
        saveModelSettings()
    }
    
    private fun updateMaxTokens(value: Int) {
        _uiState.update { it.copy(maxTokens = value) }
        saveModelSettings()
    }
    
    private fun updateTopP(value: Float) {
        _uiState.update { it.copy(topP = value) }
        saveModelSettings()
    }
    
    private fun restoreDefaults() {
        val currentRole = agentRoles[_uiState.value.selectedTabIndex]
        _uiState.update { state ->
            state.copy(
                temperature = currentRole.defaultTemperature,
                maxTokens = currentRole.defaultMaxTokens,
                topP = 0.9f
            )
        }
        saveModelSettings()
    }
    
    private fun saveModelSettings() {
        viewModelScope.launch {
            userSettingsRepository.updateModelSettings(
                temperature = _uiState.value.temperature,
                maxTokens = _uiState.value.maxTokens,
                topP = _uiState.value.topP
            )
        }
    }
}
```
    val uiState: StateFlow<ModelSettingsUiState> = _uiState.asStateFlow()
    
    init {
        loadSettings()
    }
    
    private fun loadSettings() {
        viewModelScope.launch {
            val settings = userSettingsRepository.getUserSettings().getOrNull()
            settings?.let {
                _uiState.update { state ->
                    state.copy(
                        selectedAgent = it.selectedAgent,
                        promptMode = it.promptMode,
                        customPrompt = it.customPrompt,
                        temperature = it.modelTemperature,
                        maxTokens = it.modelMaxTokens,
                        topP = it.modelTopP
                    )
                }
            }
        }
    }
    
    fun onEvent(event: ModelSettingsEvent) {
        when (event) {
            is ModelSettingsEvent.SelectAgent -> selectAgent(event.agent)
            is ModelSettingsEvent.SwitchPromptMode -> switchPromptMode(event.mode)
            is ModelSettingsEvent.UpdateCustomPrompt -> updateCustomPrompt(event.prompt)
            is ModelSettingsEvent.SaveCustomPrompt -> saveCustomPrompt()
            is ModelSettingsEvent.ResetToPreset -> resetToPreset()
            is ModelSettingsEvent.UpdateTemperature -> updateTemperature(event.value)
            is ModelSettingsEvent.UpdateMaxTokens -> updateMaxTokens(event.value)
            is ModelSettingsEvent.UpdateTopP -> updateTopP(event.value)
            is ModelSettingsEvent.RestoreDefaults -> restoreDefaults()
        }
    }
    
    private fun selectAgent(agent: AgentRole) {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            agentService.switchAgent(agent)
            
            _uiState.update { state ->
                state.copy(
                    selectedAgent = agent,
                    temperature = agent.defaultTemperature,
                    maxTokens = agent.defaultMaxTokens,
                    isLoading = false
                )
            }
        }
    }
    
    private fun switchPromptMode(mode: PromptMode) {
        _uiState.update { it.copy(promptMode = mode) }
    }
    
    private fun updateCustomPrompt(prompt: String) {
        _uiState.update { it.copy(customPrompt = prompt) }
    }
    
    private fun saveCustomPrompt() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            agentService.updateCustomPrompt(_uiState.value.customPrompt)
            
            _uiState.update { it.copy(isLoading = false) }
        }
    }
    
    private fun resetToPreset() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            agentService.resetToPreset()
            
            _uiState.update { state ->
                state.copy(
                    promptMode = PromptMode.PRESET,
                    customPrompt = "",
                    isLoading = false
                )
            }
        }
    }
    
    private fun updateTemperature(value: Float) {
        _uiState.update { it.copy(temperature = value) }
        saveModelSettings()
    }
    
    private fun updateMaxTokens(value: Int) {
        _uiState.update { it.copy(maxTokens = value) }
        saveModelSettings()
    }
    
    private fun updateTopP(value: Float) {
        _uiState.update { it.copy(topP = value) }
        saveModelSettings()
    }
    
    private fun restoreDefaults() {
        val agent = _uiState.value.selectedAgent
        _uiState.update { state ->
            state.copy(
                temperature = agent.defaultTemperature,
                maxTokens = agent.defaultMaxTokens,
                topP = 0.9f
            )
        }
        saveModelSettings()
    }
    
    private fun saveModelSettings() {
        viewModelScope.launch {
            userSettingsRepository.updateModelSettings(
                temperature = _uiState.value.temperature,
                maxTokens = _uiState.value.maxTokens,
                topP = _uiState.value.topP
            )
        }
    }
}
```

---

## æ•°æ®æŒä¹…åŒ–

### UserSettings æ‰©å±•

```kotlin
data class UserSettings(
    // ... å…¶ä»–è®¾ç½® ...
    
    // Agent æç¤ºè¯ï¼ˆæ¯ä¸ªè§’è‰²ç‹¬ç«‹ä¿å­˜ï¼‰
    val agentPrompts: Map<AgentRole, String> = emptyMap(),
    
    // æ¨¡å‹å‚æ•°
    val modelTemperature: Float = 0.7f,
    val modelMaxTokens: Int = 512,
    val modelTopP: Float = 0.9f
)
```

### Repository æ–¹æ³•

```kotlin
interface UserSettingsRepository {
    // ... å…¶ä»–æ–¹æ³• ...
    
    suspend fun updateAgentPrompts(
        prompts: Map<AgentRole, String>
    ): Result<Unit>
    
    suspend fun updateModelSettings(
        temperature: Float,
        maxTokens: Int,
        topP: Float
    ): Result<Unit>
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### Agent è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶

Agent è§’è‰²ä¼šæ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„é¡µé¢è‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©ï¼š

```kotlin
// åœ¨ MainScreen æˆ– NavGraph ä¸­å®ç°è‡ªåŠ¨åˆ‡æ¢
@Composable
fun MainScreen(navController: NavHostController) {
    val currentRoute by navController.currentBackStackEntryAsState()
    val agentService: AgentService = hiltViewModel()
    
    // æ ¹æ®å½“å‰è·¯ç”±è‡ªåŠ¨åˆ‡æ¢ Agent
    LaunchedEffect(currentRoute?.destination?.route) {
        val agent = when (currentRoute?.destination?.route) {
            Screen.Vocabulary.route -> AgentRole.VOCABULARY_TUTOR
            Screen.Speaking.route -> AgentRole.SPEAKING_PARTNER
            Screen.Writing.route -> AgentRole.ESSAY_REVIEWER
            Screen.Settings.route -> AgentRole.LEARNING_PLANNER
            else -> AgentRole.VOCABULARY_TUTOR
        }
        agentService.switchAgent(agent)
    }
    
    // ... å…¶ä»– UI ä»£ç 
}
```

### åœ¨å•è¯å­¦ä¹ ä¸­ä½¿ç”¨

```kotlin
class VocabularyViewModel @Inject constructor(
    private val agentService: AgentService
) : ViewModel() {
    
    fun explainWord(word: String) {
        viewModelScope.launch {
            // Agent å·²è‡ªåŠ¨åˆ‡æ¢ä¸º VOCABULARY_TUTOR
            // ç›´æ¥ä½¿ç”¨å½“å‰ Agent ç”Ÿæˆè§£é‡Š
            val result = agentService.generate(
                userInput = "è¯·è§£é‡Šå•è¯: $word",
                context = emptyList()
            )
            
            // å¤„ç†ç»“æœ...
        }
    }
}
```

### åœ¨å£è¯­è®­ç»ƒä¸­ä½¿ç”¨

```kotlin
class SpeakingViewModel @Inject constructor(
    private val agentService: AgentService
) : ViewModel() {
    
    fun startConversation() {
        viewModelScope.launch {
            // Agent å·²è‡ªåŠ¨åˆ‡æ¢ä¸º SPEAKING_PARTNER
            // ç”Ÿæˆå¼€åœºç™½
            val result = agentService.generate(
                userInput = "Let's start a conversation",
                context = emptyList()
            )
            
            // å¤„ç†ç»“æœ...
        }
    }
}
```

### åœ¨å†™ä½œç»ƒä¹ ä¸­ä½¿ç”¨

```kotlin
class WritingViewModel @Inject constructor(
    private val agentService: AgentService
) : ViewModel() {
    
    fun checkGrammar(text: String) {
        viewModelScope.launch {
            // ä¸´æ—¶åˆ‡æ¢åˆ°è¯­æ³•æ£€æŸ¥åŠ©æ‰‹
            val previousAgent = agentService.getCurrentAgent()
            agentService.switchAgent(AgentRole.GRAMMAR_CHECKER)
            
            // æ£€æŸ¥è¯­æ³•
            val result = agentService.generate(
                userInput = "è¯·æ£€æŸ¥è¯­æ³•: $text",
                context = emptyList()
            )
            
            // æ¢å¤ä¹‹å‰çš„ Agent
            agentService.switchAgent(previousAgent)
            
            // å¤„ç†ç»“æœ...
        }
    }
    
    fun reviewEssay(essay: String) {
        viewModelScope.launch {
            // Agent å·²è‡ªåŠ¨åˆ‡æ¢ä¸º ESSAY_REVIEWER
            // æ‰¹æ”¹ä½œæ–‡
            val result = agentService.generate(
                userInput = "è¯·æ‰¹æ”¹ä½œæ–‡: $essay",
                context = emptyList()
            )
            
            // å¤„ç†ç»“æœ...
        }
    }
}
```

### åœ¨æ¨¡å‹è®¾ç½®é¡µé¢ä¸­

ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘æ¯ä¸ª Agent è§’è‰²çš„ç³»ç»Ÿæç¤ºè¯ï¼š

```kotlin
@Composable
fun ModelSettingsScreen(
    viewModel: ModelSettingsViewModel = hiltViewModel()
) {
    val uiState by viewModel.uiState.collectAsState()
    
    Column {
        // è§’è‰²é€‰é¡¹å¡
        ScrollableTabRow(
            selectedTabIndex = uiState.selectedTabIndex,
            onTabSelected = { index ->
                viewModel.onEvent(ModelSettingsEvent.SelectTab(index))
            }
        )
        
        // æç¤ºè¯ç¼–è¾‘æ¡†
        TextField(
            value = uiState.currentPrompt,
            onValueChange = { prompt ->
                viewModel.onEvent(ModelSettingsEvent.UpdatePrompt(prompt))
            },
            modifier = Modifier.fillMaxWidth().height(300.dp)
        )
        
        // æ“ä½œæŒ‰é’®
        Row {
            Button(
                onClick = { viewModel.onEvent(ModelSettingsEvent.SavePrompt) },
                enabled = uiState.hasUnsavedChanges
            ) {
                Text("ä¿å­˜")
            }
            
            Button(
                onClick = { viewModel.onEvent(ModelSettingsEvent.ResetToPreset) }
            ) {
                Text("é‡ç½®ä¸ºé¢„è®¾")
            }
        }
    }
}
```
